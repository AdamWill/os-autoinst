#!/bin/sh

iso=$1
if test -z "$iso" ; then
	echo "usage: $0 ISO"
	exit 1
fi
isodir=`pwd`
#isodir=~/public_html/mirror/opensuse
scriptdir=`dirname $0`/..
# make absolute path since we change dir
export SUSEISO=`$scriptdir/tools/absolutize $iso`
cd $scriptdir
echo changing directory to `/bin/pwd`
export PERLLIB=$scriptdir

. env.sh
echo testing $SUSEISO
# cleanup
killall kvm 2>/dev/null
rm -rf qemuscreenshot/*.ppm
./start.pl
killall kvm 2>/dev/null

name=$(perl -e '$_=shift;s{.*/}{};s/-Media.iso//;print' $SUSEISO)
mkdir -p video
echo tools/ppmtompg qemuscreenshot video/$name
tools/ppmtompg qemuscreenshot video/$name
mv video/* $isodir/video/

